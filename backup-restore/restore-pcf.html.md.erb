---
title: Restoring Pivotal Cloud Foundry&reg; from Backup
owner: RelEng
---

<strong><%= modified_date %></strong>

<% $this_topic = 'restore-pcf' %>

This topic describes the procedure for restoring <%= vars.product_full %> from a backup. To create a backup, see the [Backing Up Pivotal Cloud Foundry&reg;](./backup-pcf.html) topic.

To restore a deployment, you must import installation settings, temporarily stop the Cloud Controller, restore the state of each critical backend component from its backup file, and restart the Cloud Controller. Using the BOSH manifest to locate your critical backend components is necessary to perform these steps. Manifests are automatically downloaded to the Ops Manager virtual machine. However, if you are using a separate jumpbox, you must manually download the BOSH deployment manifest.

<p class='note'><strong>Note</strong>:
The procedure described in this topic restores a running <%= vars.product_full %> deployment to the state captured by backup files. This procedure does not deploy <%= vars.product_full %>. See the
<a href='../../installing/index.html'>Getting Started Guide</a> for information about deploying <%= vars.product_full %>.
</p>

## <a id='import'></a>Import Installation Settings ##

<p class='note'><strong>Note</strong>: Pivotal recommends that you export your installation settings before importing from a backup. See the <a href='./backup-pcf.html#export'>Export Installation Settings</a> section of the <i>Backing Up Pivotal Cloud Foundry&reg;</i> topic for more information.</p>

**Import installation settings** imports the settings and assets of an existing
PCF installation. Importing an installation overwrites any existing installation. You must provision a new Ops Manager in order to import settings. 

1. Deploy the new Ops Manager VM:
  * [Launching an Ops Manager Director Instance on AWS](../cloudform-om-deploy.html)
  * [Provisioning the OpenStack Infrastructure](../openstack-setup.html)
  * [Deploying Operations Manager to vSphere](../deploying-vm.html)
  * [Deploying Operations Manager to vCloud Air and vCloud](../pcf-vchs-vcloud.html)


1. When redirected to the **Welcome to Ops Manager** page, select **Import Existing Installation**. 

    <%= image_tag("../images/upgrading/welcome.png") %>

1. When prompted, enter the following:
  * **Decryption Passphrase**, which is the same as your password. 
  * Click **Choose File** and browse to the installation zip file that you exported in the [Export Installation Settings](./backup-pcf.html#export) section.

    <%= image_tag("../images/upgrading/decryption_passphrase.png") %>

1. Click **Import**.

    <p class="note"><strong>Note</strong>: 
      Some browsers do not provide feedback on the status of the import process,
      and may appear to hang.</p>

1. Before you see the new PCF 1.7 **Installation Dashboard**, a Security Features alert appears. Take note of your new **username**. Ensure you change your decryption passphrase before sharing it with other users. Click **Continue**.

    <%= image_tag("../images/upgrading/security_features.png") %>

1. A "Successfully imported installation" message appears upon completion.

    <%= image_tag("../images/upgrading/success.png") %>

1. Click **Apply Changes**. This immediately imports and applies upgrades to all tiles in a single transaction.

## <a id='manifest'></a>Download the BOSH Deployment Manifest ##
<%= partial 'download_bosh_manifest' %>

## <a id='restore-databases'></a>Restoring Critical Backend Components##

Your Elastic Runtime deployment contains two critical data stores that must be present for a complete restore. This section describes the procedure for restoring the servers associated with your PCF installation.

You must restore each of the following:

* NFS Server
* Pivotal MySQL Server

### <a id='stop-cc'></a>Stop Cloud Controller###

<%= partial 'stopping_cc' %>

### <a id='restore-nfs'></a>Restore NFS
Use the NFS password and IP address to restore the NFS by following the steps detailed below. Find the IP address in your BOSH deployment manifest. To find your password in the Ops Manager **Installation Dashboard**, select **Elastic Runtime** and click **Credentials>Link to Credential**.

1. Use `scp` to send the NFS backup tarball to the NFS VM.
<pre class='terminal'>
    $ scp nfs.tar.gz vcap@YOUR-NFS-VM-IP-ADDRESS:~/.
</pre>

1. Run `ssh YOUR-NFS-VM-IP-ADDRESS` to enter the NFS VM.
<pre class='terminal'>
	$ ssh vcap@10.0.0.10
</pre>

1. Log in as root user. When prompted for a password, enter the vcap password you used to `ssh` into the VM:
<pre class='terminal'>$ sudo su</pre>

1. Run the following command to create a store folder if one does not exist:
<pre class='terminal'>
    $ mkdir -p /var/vcap/store
</pre>

1. Record the permissions on `var/vcap/store` so that you can restore them after running the commands below. To view the permissions, run the following command:
<pre class='terminal'>
	$ ls -ld /var/vcap/store
</pre>

1. Temporarily change the permissions on `var/vcap/store` to `777`.
<pre class='terminal'>
	$ chmod 777 /var/vcap/store
</pre>

1. Move the backup archive to the `store` folder.
<pre class='terminal'>
	$ mv nfs.tar.gz /var/vcap/store
</pre>

1. `cd` into the `store` folder.
<pre class='terminal'>
	$ cd /var/vcap/store
</pre>

1. Decompress and extract the contents of the backup archive.
<pre class='terminal'>
	$ tar zxf nfs.tar.gz</pre>
</pre>

1. Change the permissions on `var/vcap/store` to their prior setting.
<pre class='terminal'>
    $ chmod YOUR-PRIOR-PERMISSION /var/vcap/store
</pre>

1. Exit the NFS VM.
<pre class='terminal'>
    $ exit
</pre>


### <a id='restore-mysql-dev'></a>Restore MySQL Database ###
  
 1. Use `scp` to send the MySQL Database backup file to the MySQL Database VM. Find the IP address in your BOSH deployment manifest. To find your password in the Ops Manager Installation Dashboard, select **Elastic Runtime** and click **Credentials**.
	 <pre class='terminal'>
	    $ scp user_databases.sql vcap@YOUR-MYSQL-VM-IP-ADDRESS:~/.
	 </pre>
 
 1. SSH into the MySQL Database VM.
	 <pre class='terminal'>
	 $ ssh vcap@YOUR-MYSQL-VM-IP
	 </pre>
 
 1. Use the MySQL password and IP address to restore the MySQL database by running the following command. 
	 <pre class='terminal'>
	   mysql -h YOUR-MYSQL-SERVER-IP -u root -p < ~/.user_databases.sql
	 </pre>
	 
 1. Log in to the MySQL client and flush privileges.
	 <pre class='terminal'>
	     $ mysql -u root -p -h
	     mysql > flush privileges;
	 </pre>

### <a id='cc-start-2'></a>Start Cloud Controller ###
<%= partial 'starting_cc' %>
